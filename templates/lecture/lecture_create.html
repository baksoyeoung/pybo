{% extends 'lecture/lecture_base.html' %}
{% block content %}
<div class="row g-5 justify-content-center">
  <div class="col-md-7 col-lg-7">
    <h4 class="mb-3">강의정보입력</h4>
    <form  name="lecture_info" method="post" class="needs-validation" novalidate>
      {% csrf_token %}
<!--      {{ form.as_p }}-->

      <div class="row g-3">
        <div class="col-md-5">
          <label for="season_nm" class="form-label">학기선택</label>
          <select class="form-select" id="season_nm" name="season_nm" required>
            <option value="">학기선택...</option>
            {% if season_list %}
              {% for season in season_list %}
                <option value="{{season.season_nm}}" {% if season.season_nm == form.season_nm.value %}{{ 'selected' }}{% endif %}>{{season.season_nm}}</option>
              {% endfor %}
            {% endif %}
          </select>
          <div class="invalid-feedback">
            Please select a valid country.
          </div>
        </div>

        <div class="col-md-5">
          <label for="camp_nm" class="form-label">캠퍼스선택</label>
          <select class="form-select" id="camp_nm" name="camp_nm" required>
            <option value="">캠퍼스선택...</option>
            {% if campus_list %}
              {% for campus in campus_list %}
                <option value="{{campus.camp_nm}}" {% if campus.camp_nm == form.camp_nm.value %}{{ 'selected' }}{% endif %}>{{campus.camp_nm}}</option>
              {% endfor %}
            {% endif %}
          </select>
          <div class="invalid-feedback">
            Please select a valid country.
          </div>
        </div>

        <div class="col-md-5">
          <label for="subject" class="form-label">과목선택</label>
          <select class="form-select" id="subject" name="subject" required>
            <option value="">과목선택...</option>
            {% if subjects_list %}
              {% for subjects in subjects_list %}
                <option value="{{subjects.subject_nm}}" {% if subjects.subject_nm == form.subject.value %}{{ 'selected' }}{% endif %}>{{subjects.subject_nm}}</option>
              {% endfor %}
            {% endif %}
          </select>
          <div class="invalid-feedback">
            Please select a valid country.
          </div>
        </div>

        <div class="col-md-12">
          <label for="lect_grade" class="form-label">대상학년</label>
          <ul class="list-group" id="lect_grade" name="lect_grade">
            <li class="list-group-item">
              <input class="form-check-input" type="checkbox" value="예비중1" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="pmiddle1">예비중1</label>
              <input class="form-check-input" type="checkbox" value="예비중2" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="pmiddle2">예비중2</label>
              <input class="form-check-input" type="checkbox" value="예비중3" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="pmiddle3">예비중3</label>
            </li>
            <li class="list-group-item">
              <input class="form-check-input" type="checkbox" value="중1" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="middle1">중1</label>
              <input class="form-check-input" type="checkbox" value="중2" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="middle2">중2</label>
              <input class="form-check-input" type="checkbox" value="중3" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="middle3">중3</label>
            </li>
            <li class="list-group-item">
              <input class="form-check-input" type="checkbox" value="예비고1" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="phigh1">예비고1</label>
              <input class="form-check-input" type="checkbox" value="예비고2" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="phigh2">예비고2</label>
              <input class="form-check-input" type="checkbox" value="예비고3" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="phigh3">예비고3</label>
            </li>
            <li class="list-group-item">
              <input class="form-check-input" type="checkbox" value="고1" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="high1">고1</label>
              <input class="form-check-input" type="checkbox" value="고2" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="high2">고2</label>
              <input class="form-check-input" type="checkbox" value="고3" id="lect_grade" name="lect_grade">
              <label class="form-check-label" for="high3">고3</label>
            </li>
          </ul>
        </div>

        <div class="col-md-5">
          <label for="name" class="form-label">강사명선택</label>
          <select class="form-select" id="name" name="name" required>
            <option value="">강사명선택...</option>
            {% if teacher_list %}
              {% for teacher in teacher_list %}
                <option value="{{ teacher.name }}" {% if teacher.name == form.name.value %}{{ 'selected' }}{% endif %}>{{ teacher.name }}</option>
              {% endfor %}
            {% endif %}
          </select>
          <div class="invalid-feedback">
            Please select a valid country.
          </div>
        </div>

        <div class="col-sm-7">
          <label for="lect_nm" class="form-label">강의명</label>
          <input type="text" class="form-control" id="lect_nm" name="lect_nm" placeholder="강의명입력" value="{{ form.lect_nm.value|default_if_none:'' }}" required>
          <div class="invalid-feedback">
            Valid last name is required.
          </div>
        </div>

        <div class="col-sm-12">
          <label for="lect_explan" class="form-label">강의설명</label>
          <textarea class="form-control" id="lect_explan" name="lect_explan" rows="3" placeholder="강의에 대한 설명">{{ form.lect_explan.value|default_if_none:'' }}</textarea>
        </div>

        <div class="buttons">
          <label for="yoiltime" class="form-label">등원 요일/시간</label>
          <ul class="list-group yoiltime" id="yoiltime">
            <li class="list-group-item">
              <input class="form-check-input" type="checkbox" value="1" id="timeselect" name="timeselect" {% if form.timeselect.value %}{{ 'checked' }}{% endif %}>
              <label class="form-check-label" for="timeselect">등원시간협의</label>
            </li>
            <li class="list-group-item">
            <select class="yoil" id="lect_yoil" name="lect_yoil">
              <option>요일선택</option>
              <option value="월">월요일</option>
              <option value="화">화요일</option>
              <option value="수">수요일</option>
              <option value="목">목요일</option>
              <option value="금">금요일</option>
              <option value="토">토요일</option>
              <option value="일">일요일</option>
            </select>
            <input type="time" class="time1 timepicker" id="lect_time1" name="lect_time" placeholder="시작시간"><span> ~ </span><input type="time" class="time2 timepicker" id="lect_time2" name="lect_time2"  placeholder="종료시간">
            <input type="button" class="btn btn-primary btn-sm btnAdd" data-bs-toggle="tooltip" data-bs-placement="right" title="Tooltip on right" value="추가">
            </li>
          </ul>
        </div>

        <div class="col-sm-2">
          <label for="week_cnt" class="form-label">시간개수</label>
          <div class="input-group has-validation">
            <input type="number" class="form-control week-cnt" id="week_cnt" name="week_cnt" placeholder="숫자만입력" value="{{ form.week_cnt.value|default_if_none:'' }}" readonly>
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div>
        </div>

        <div class="col-sm-3">
          <label for="week_cnt" class="form-label">수강개수</label>
          <div class="input-group has-validation">
            <input type="number" class="form-control in-cnt" id="in_cnt" name="in_cnt" placeholder="숫자만입력" value="{{ form.in_cnt.value|default_if_none:'' }}">
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div>
        </div>

        <div class="col-sm-3">
          <label for="lect_fee" class="form-label">수강료(원)</label>
          <div class="input-group has-validation">
            <input type="number" class="form-control" id="lect_fee" name="lect_fee" placeholder="숫자만입력" value="{{ form.lect_fee.value|default_if_none:'' }}">
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div>
        </div>

        <div class="col-sm-4">
          <label for="lect_fee_explan" class="form-label">수강료추가설명</label>
          <div class="input-group has-validation">
            <textarea class="form-control" id="lect_fee_explan" name="lect_fee_explan" rows="3" placeholder="추가설명">{{ form.lect_fee_explan.value|default_if_none:'' }}</textarea>
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div>
        </div>

      <hr class="my-4">

      <button class="w-100 btn btn-primary btn-lg insert" type="submit">강의등록하기</button>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">강의입력완료</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <h5>강의가 추가 되었습니다. <span class="badge rounded-pill bg-success">Success</span></h5>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
<!--                    <button type="button" class="btn btn-primary">Save changes</button>-->
              </div>
            </div>
          </div>
        </div>
        <!-- end Modal -->
      </div>
    </form>
  </div>
</div>
{% endblock %}
{% block script %}
<script>
    $(document).ready(function(){
        $('#week_cnt').val(count_input());
        $('.btnAdd').click (function(){
            $('.yoiltime').append('<li class="list-group-item lecture-time"><select id="lect_yoil" name="lect_yoil"><option>요일선택</option><option value="월">월요일</option><option value="화">화요일</option><option value="수">수요일</option><option value="목">목요일</option><option value="금">금요일</option><option value="토">토요일</option><option value="일">일요일</option></select> <input type="time" class="time1 timepicker" id="lect_time1" name="lect_time"><span> ~ </span><input type="time" class="timepicker" id="lect_time2" name="lect_time2"> <input type="button" class="btn btn-primary btn-sm btnRemove Remove" value="삭제"></li>'); // end append
            $('input.timepicker').timepicker({
              timeFormat: 'HH:mm',
              interval: 30,
              startTime: '08:00',
              dynamic: false,
              dropdown: true,
              scrollbar: true
            });
            $('#week_cnt').val(count_input());
            $('.btnRemove').on('click', function(){
                $(this).prev().remove (); // remove
                $(this).prev().remove (); // remove
                $(this).prev().remove (); // remove
                $(this).prev().remove (); // remove
                $(this).unwrap();
                $(this).remove(); // remove the button
                $('.week-cnt').val(count_input());
            });
        }); // end click

        function count_input(){
          let length = $('.time1').length;
          return length;
        }

        $('input.timepicker').timepicker({
          timeFormat: 'HH:mm',
          interval: 30,
          startTime: '08:00',
          dynamic: false,
          dropdown: true,
          scrollbar: true
        });

        $(':checkbox[name="timeselect"]').on({
          click: function(e) {
            if($('#timeselect').is(':checked')){
              $('.week-cnt').val(1);
              $('.in-cnt').val('');
              $('.lecture-time').remove();
              $('.in-cnt').prop('readonly', true);
              $('.btnAdd').prop('disabled', true);
              $('.yoil').prop('disabled', true);
              $('.time1').val('');
              $('.time2').val('');
              $('.time1').prop('disabled', true);
              $('.time2').prop('disabled', true);
            }else{
              $('.week-cnt').val(count_input());
              $('.in-cnt').prop('readonly', false);
              $('.btnAdd').prop('disabled', false);
              $('.yoil').prop('disabled', false);
              $('.time1').prop('disabled', false);
              $('.time2').prop('disabled', false);
            }
          },
          change: function(e) {

          }
        });

        if($('#timeselect').is(':checked')){
          $('.week-cnt').val(1);
          $('.in-cnt').val('');
          $('.lecture-time').remove();
          $('.in-cnt').prop('readonly', true);
          $('.btnAdd').prop('disabled', true);
          $('.yoil').prop('disabled', true);
          $('.time1').val('');
          $('.time2').val('');
          $('.time1').prop('disabled', true);
          $('.time2').prop('disabled', true);
        }

        //submit 이후 다시 폼 제출시 대상학년 체크
        {{ form.lect_grade.value.count }}
        {% if form.lect_grade.value %}
          {% for grade in form.lect_grade.value %}

              //var grade_cnt = $("input:checkbox[id=lect_grade]").length;
              //alert(grade_cnt);

              $("input:checkbox[id=lect_grade]").each(function(){
                if(this.value == "{{grade}}"){
                  this.checked = true;
                }
              });

          {% endfor %}
        {% endif %}

        $(".insert").on('click', function(){
          if ($("#season_nm").val() == ""){
            $("#season_nm").focus();
              return false;
          }
          if ($("#camp_nm").val() == ""){
            $("#camp_nm").focus();
              return false;
          }
          if ($("#subject").val() == ""){
            $("#subject").focus();
              return false;
          }
          var check_cnt = $("input:checkbox[id=lect_grade]:checked").length;
          if (check_cnt == 0){
            $('input[id^=lect_grade]')[0].focus();
            return false;
          }
          if ($("#name").val() == ""){
            $("#name").focus();
              return false;
          }
          if ($("#lect_nm").val() == ""){
            $("#lect_nm").focus();
              return false;
          }
          var timeselect_chk = $("input:checkbox[id=timeselect]:checked").length;
          if (timeselect_chk != 1){
            if ($("#in_cnt").val() == ""){
              $("#in_cnt").focus();
                return false;
            }
          }
          if ($("#lect_fee").val() == ""){
            $("#lect_fee").focus();
              return false;
          }

          $("form").submit();
        });

        if ("{{ form.lect_nm.value }}" != 'None'){ //강의가 입력 되었다는 모달
          //alert("{{ form.lect_nm.value }}");
          $('.modal').modal('show');
        }


    }); // end ready
</script>
{% endblock %}